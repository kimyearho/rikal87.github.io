var DataMagnet=function(e,t){function a(e,t){var a;switch(a=$(t).is("input, textarea, select, button")?$(t).val():$(t).text(),typeof e){case"number":a=Number(a);break;case"boolean":a="checkbox"===$(t).attr("type")?$(t).is(":checked"):"0"==a||""==a||"false"==a.toLowerCase()?!1:!0}return a}this.dataRef="data-ref",this.deleteSelector=!0,this.scope=$(e),this.dependency=t||!1;var i=0;this.cloneElement=function(e,t,a,n,o){var r=this,s=this.dataRef;for(var c in t)$(e).each(function(e,d){var h=$(d).clone(),l=$(h).attr(s);h.attr("id",null),h.addClass("databinder-created"),h.attr("data-idx",c),r._update(h,t[c],a,n,o,i++),h.insertAfter(1==n||0==$(d).next(".databinder-created").length?d:$(d).nextAll(".databinder-created").last()),void 0!==a&&void 0!==a[l]&&a[l]($(h),t,l),void 0!==a&&a.hasOwnProperty("this")&&a["this"]($(h),t,l)})},this.bind=function(e,t){this.cloneElement(this.scope,e,t,!1,!0),this.deleteSelector&&$(this.scope).remove()},this.remove=function(){$(this.scope).nextAll(".databinder-created").remove()},this.update=function(e,t){this._update(this.scope,e,t,!1,!1)},this._update=function(e,t,i,n,o,r){var s=this,c=this.dataRef;$(e).find("["+c+"]").each(function(e,d){var h=$(d).attr(c);if(t.hasOwnProperty(h)){if("object"==typeof t[h]&&-1!==t[h].toString().indexOf("Object")){var l;void 0!==i&&i.hasOwnProperty(h)&&(l=i[h]),o&&s.cloneElement($(d),t[h],l,n,o),void 0!==l&&l.hasOwnProperty("this")&&l["this"]($(d),t,h),s.deleteSelector&&$(d).remove()}else s.bindingValueOfElement(d,t,h,s,r),void 0!==i&&void 0!==i.ALL&&i.ALL($(d),t,h);s.dependency&&$(d).change(function(){t[h]=a(t[h],d)})}void 0!==i&&i.hasOwnProperty(h)&&"function"==typeof i[h]&&i[h]($(d),t,h)})},this.insert=function(e,t){this.cloneElement(this.scope,e,t,!0,!0)},this.bindingValueOfElement=function(e,t,a,i,n){if($(e).is("input, textarea, select, button"))switch($(e).prop("type")){case"checkbox":$(e).prop("checked",t[a]);break;case"radio":$(e).prop("name",$(e).attr("name")||$(e).attr(i.dataRef)+"-"+n),$(e).filter("[value="+t[a]+"]").prop("checked",!0);break;default:$(e).val(t[a])}else $(e).text(t[a])}};
